<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; object-src 'none'; base-uri 'none'; frame-ancestors 'none'">
    <title>DH Â· ECDH Key Exchange</title>
    <link rel="icon" href="favicon.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrap">
      <div id="compat-warning" class="card" style="display:none">
        <strong class="warn">Note:</strong> This environment seems to lack WebCrypto SubtleCrypto. Use a modern browser and open this page via a local HTTP server (e.g., <span class="mono">python -m http.server</span>).
      </div>

      <div class="card">
        <h1>DH Key Exchange</h1>
        <div class="muted">Algorithms: ECDH over NIST P-256 (secp256r1) to derive a 256-bit AES-GCM key (no HKDF). IV = 96-bit random. Ciphertext JSON { v, alg, iv, ct } with base64 fields. Key fingerprint = SHA-256 of raw AES key.</div>
      </div>

      <div class="card grid">
        <h2>Step 1: My Key Pair</h2>
        <div class="btns">
          <button data-id="genBtn">Generate My Key Pair</button>
          <button data-id="copyMyPub" class="secondary" disabled>Copy Public Key</button>
        </div>
        <label>My Public Key (send to peer):</label>
        <textarea data-id="myPub" class="mono" readonly autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false"></textarea>
        <label>Private Key JWK (keep secret; paste here to import):</label>
        <textarea data-id="privJwk" class="mono" data-sanitize placeholder='{"kty":"EC","crv":"P-256","d":"...","x":"...","y":"..."}' autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false"></textarea>
        <div class="btns"><button data-id="importPrivBtn" class="success">Import Private Key</button></div>
        <div class="footer" data-id="importStatus"></div>
      </div>

      <div class="card grid">
        <h2>Step 2: Establish Session Key</h2>
        <label>Peer Public Key (JWK JSON):</label>
        <textarea data-id="peerPub" class="mono" data-sanitize placeholder='{"kty":"EC","crv":"P-256","x":"...","y":"..."}' autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false"></textarea>
        <div class="btns">
          <button data-id="buildSessionBtn" class="success" disabled>Establish Session Key</button>
        </div>
        <label>Session Key Fingerprint (SHA-256): <span class="pill">Verify both sides match</span></label>
        <input data-id="fingerprint" class="mono" type="text" readonly />
      </div>

      <div class="card grid">
        <h2>Step 3: Encrypt / Decrypt</h2>
        <div class="row">
          <div class="col">
            <label>Plaintext:</label>
            <textarea data-id="plain" data-sanitize placeholder="Enter text to encrypt" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false"></textarea>
            <div class="btns">
              <button data-id="encryptBtn" disabled>Encrypt -></button>
            </div>
          </div>
          <div class="col">
            <label>Ciphertext (JSON, share with peer):</label>
            <textarea data-id="cipher" class="mono" data-sanitize placeholder='{"v":1,"alg":"ECDH-P256/AES-GCM-256","iv":"...","ct":"..."}' autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false"></textarea>
            <div class="btns">
              <button data-id="decryptBtn" class="secondary" disabled><- Decrypt</button>
            </div>
          </div>
        </div>
        <div class="footer" data-id="status"></div>
      </div>

    </div>

    <script src="js/dh.js"></script>
  </body>
  </html>
